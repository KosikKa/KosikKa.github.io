<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="/manifest.webmanifest">
  <title>Entropy calculator</title>
</head>
<body>
  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-messaging.js"></script>
  <script src="service_worker_registration.js"></script>

  <div class="container">
    <form id="calculator">

      <label for="input_field">Введите ваш пароль</label>
      <input type="text" name="input_field" id="input_field">

      <label for="result_field">Результат</label>
      <output name="result_field" id="result_field">...</output>

      <button type="button" name="calculate_button" id="calculate_button">Рассчитать</button>

    </form>

  </div>

  <div class="container notify_button_container">
    <button type="button" id="notification_subscribe">Подписаться на уведомления</button>
    <div id="user_token"></div>
    <script>
      // Проверяем, поддерживает ли браузер API уведомлений
      if ('Notification' in window) {
        // Проверяем, поддерживает ли браузер API push-уведомлений
        if ('serviceWorker' in navigator && 'PushManager' in window) {
          // Регистрируем service worker
          navigator.serviceWorker.register('/firebase-messaging-sw.js', { scope: '/' })
            .then(() => {
              console.log('Service Worker для Firebase Messaging зарегистрирован');
              // Получаем токен устройства
              const messaging = firebase.messaging();
              messaging.getToken({ vapidKey: 'ВАШ_PUBLIC_VAPID_KEY' })
                .then((currentToken) => {
                  if (currentToken) {
                    // Выводим токен устройства на экран
                    document.getElementById('user_token').textContent = 'Ваш токен: ' + currentToken;
                  } else {
                    // Выводим сообщение об ошибке на экран
                    document.getElementById('user_token').textContent = 'Не удалось получить токен устройства. Пользователь отклонил разрешение на уведомления.';
                  }
                })
                .catch((error) => {
                  // Выводим сообщение об ошибке на экран
                  document.getElementById('user_token').textContent = 'Ошибка при получении токена устройства: ' + error;
                });
            })
            .catch((error) => {
              console.error('Ошибка регистрации Service Worker для Firebase Messaging:', error);
            });
        } else {
          // Выводим сообщение об ошибке на экран
          document.getElementById('user_token').textContent = 'Браузер не поддерживает API push-уведомлений.';
        }
      } else {
        // Выводим сообщение об ошибке на экран
        document.getElementById('user_token').textContent = 'Браузер не поддерживает API уведомлений.';
      }
    </script>
  </div>

  <script src="symbols_information.js"></script>
  <script src="validation.js"></script>
  <script src="password_entropy_calculator.js"></script>
</body>
</html>
